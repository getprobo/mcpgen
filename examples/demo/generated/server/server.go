// Code generated by mcpgen. DO NOT EDIT.

package server

import (
	mcp_v1 "demo/generated"
	"demo/generated/types"
	"github.com/modelcontextprotocol/go-sdk/mcp"
	mcputil "go.probo.inc/mcpgen/mcp"
)

// New creates a new MCP server instance with all handlers registered.
// Returns a fully configured *mcp.Server ready to be used with any transport.
func New(resolver *mcp_v1.Resolver) *mcp.Server {
	server := mcp.NewServer(
		&mcp.Implementation{
			Name:    "demo-server",
			Version: "1.0.0",
		},
		nil,
	)

	toolResolver := &mcp_v1.ToolResolver{resolver}
	resourceResolver := &mcp_v1.ResourceResolver{resolver}
	promptResolver := &mcp_v1.PromptResolver{resolver}

	registerToolHandlers(server, toolResolver)
	registerResourceHandlers(server, resourceResolver)
	registerPromptHandlers(server, promptResolver)

	return server
}

func registerToolHandlers(server *mcp.Server, toolResolver *mcp_v1.ToolResolver) {
	mcp.AddTool(
		server,
		&mcp.Tool{
			Name:         "calculate",
			Description:  "Perform basic arithmetic operations",
			InputSchema:  types.CalculateToolInputSchema,
			OutputSchema: types.CalculateToolOutputSchema,
		},
		toolResolver.Calculate,
	)
	mcp.AddTool(
		server,
		&mcp.Tool{
			Name:        "calculate2",
			Description: "Perform basic arithmetic operations",
			InputSchema: types.Calculate2ToolInputSchema,
		},
		toolResolver.Calculate2,
	)
	mcp.AddTool(
		server,
		&mcp.Tool{
			Name:         "create_task",
			Description:  "Create a new task",
			InputSchema:  types.CreateTaskToolInputSchema,
			OutputSchema: types.CreateTaskToolOutputSchema,
		},
		toolResolver.CreateTask,
	)
	mcp.AddTool(
		server,
		&mcp.Tool{
			Name:        "search",
			Description: "Search for items",
			InputSchema: types.SearchToolInputSchema,
		},
		toolResolver.Search,
	)
	mcp.AddTool(
		server,
		&mcp.Tool{
			Name:        "get_history",
			Description: "Get calculation history",
			InputSchema: types.GetHistoryToolInputSchema,
		},
		toolResolver.GetHistory,
	)
}

func registerResourceHandlers(server *mcp.Server, resourceResolver *mcp_v1.ResourceResolver) {
	server.AddResource(
		&mcp.Resource{
			URI:         "docs://readme",
			Name:        "Demo README",
			Description: "Documentation for the demo server",
			MIMEType:    "text/markdown",
		},
		resourceResolver.DemoREADME,
	)
	server.AddResourceTemplate(
		&mcp.ResourceTemplate{
			URITemplate: "task://{id}",
			Name:        "Task Details",
			Description: "Get details for a specific task",
			MIMEType:    "application/json",
		},
		resourceResolver.TaskDetails,
	)
	server.AddResourceTemplate(
		&mcp.ResourceTemplate{
			URITemplate: "result://{operation}",
			Name:        "Last Result",
			Description: "Get the last result for a specific operation",
			MIMEType:    "application/json",
		},
		resourceResolver.LastResult,
	)
}

func registerPromptHandlers(server *mcp.Server, promptResolver *mcp_v1.PromptResolver) {
	mcputil.AddPrompt(
		server,
		&mcp.Prompt{
			Name:        "task_help",
			Description: "Get help with task management",
			Arguments: []*mcp.PromptArgument{
				{
					Name:        "topic",
					Description: "The help topic (tasks, priorities, etc)",
					Required:    false,
				},
				{
					Name:        "detailed",
					Description: "Whether to show detailed help",
					Required:    false,
				},
			},
		},
		promptResolver.TaskHelp,
	)
	mcputil.AddPrompt(
		server,
		&mcp.Prompt{
			Name:        "math_help",
			Description: "Get help with mathematical operations",
			Arguments: []*mcp.PromptArgument{
				{
					Name:        "operation",
					Description: "The operation to get help with",
					Required:    false,
				},
			},
		},
		promptResolver.MathHelp,
	)
}
