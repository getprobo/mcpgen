// Code generated by mcpgen. DO NOT EDIT.

package server

import (
	"context"
	"demo/generated/types"
	"github.com/modelcontextprotocol/go-sdk/mcp"
	mcputil "go.probo.inc/mcpgen/mcp"
)

// ResolverInterface defines the interface that must be implemented by the parent resolver
type ResolverInterface interface {
	CalculateTool(ctx context.Context, req *mcp.CallToolRequest, input *types.CalculateInput) (*mcp.CallToolResult, types.CalculateOutput, error)
	Calculate2Tool(ctx context.Context, req *mcp.CallToolRequest, input *types.Calculate2Input) (*mcp.CallToolResult, map[string]any, error)
	CreateTaskTool(ctx context.Context, req *mcp.CallToolRequest, input *types.CreateTaskInput) (*mcp.CallToolResult, types.CreateTaskOutput, error)
	SearchTool(ctx context.Context, req *mcp.CallToolRequest, input *types.SearchInput) (*mcp.CallToolResult, map[string]any, error)
	GetHistoryTool(ctx context.Context, req *mcp.CallToolRequest, input *types.GetHistoryInput) (*mcp.CallToolResult, map[string]any, error)
	DemoREADMEResource(ctx context.Context, req *mcp.ReadResourceRequest) (*mcp.ReadResourceResult, error)
	TaskDetailsResource(ctx context.Context, req *mcp.ReadResourceRequest) (*mcp.ReadResourceResult, error)
	LastResultResource(ctx context.Context, req *mcp.ReadResourceRequest) (*mcp.ReadResourceResult, error)
	TaskHelpPrompt(ctx context.Context, req *mcp.GetPromptRequest, args types.TaskHelpArgs) (*mcp.GetPromptResult, error)
	MathHelpPrompt(ctx context.Context, req *mcp.GetPromptRequest, args types.MathHelpArgs) (*mcp.GetPromptResult, error)
}

// New creates a new MCP server instance with all handlers registered.
// Returns a fully configured *mcp.Server ready to be used with any transport.
func New(resolver ResolverInterface) *mcp.Server {
	server := mcp.NewServer(
		&mcp.Implementation{
			Name:    "demo-server",
			Version: "1.0.0",
		},
		nil,
	)

	registerToolHandlers(server, resolver)
	registerResourceHandlers(server, resolver)
	registerPromptHandlers(server, resolver)

	return server
}

func registerToolHandlers(server *mcp.Server, resolver ResolverInterface) {
	mcp.AddTool(
		server,
		&mcp.Tool{
			Name:         "calculate",
			Description:  "Perform basic arithmetic operations",
			InputSchema:  types.CalculateToolInputSchema,
			OutputSchema: types.CalculateToolOutputSchema,
			Annotations: &mcp.ToolAnnotations{
				IdempotentHint: true,
			},
		},
		resolver.CalculateTool,
	)
	mcp.AddTool(
		server,
		&mcp.Tool{
			Name:        "calculate2",
			Description: "Perform basic arithmetic operations",
			InputSchema: types.Calculate2ToolInputSchema,
			Annotations: &mcp.ToolAnnotations{
				IdempotentHint: true,
			},
		},
		resolver.Calculate2Tool,
	)
	mcp.AddTool(
		server,
		&mcp.Tool{
			Name:         "create_task",
			Description:  "Create a new task",
			InputSchema:  types.CreateTaskToolInputSchema,
			OutputSchema: types.CreateTaskToolOutputSchema,
		},
		resolver.CreateTaskTool,
	)
	mcp.AddTool(
		server,
		&mcp.Tool{
			Name:        "search",
			Description: "Search for items",
			InputSchema: types.SearchToolInputSchema,
			Annotations: &mcp.ToolAnnotations{
				ReadOnlyHint:   true,
				IdempotentHint: true,
			},
		},
		resolver.SearchTool,
	)
	mcp.AddTool(
		server,
		&mcp.Tool{
			Name:        "get_history",
			Description: "Get calculation history",
			InputSchema: types.GetHistoryToolInputSchema,
			Annotations: &mcp.ToolAnnotations{
				ReadOnlyHint:   true,
				IdempotentHint: true,
			},
		},
		resolver.GetHistoryTool,
	)
}

func boolPtr(b bool) *bool {
	return &b
}

func registerResourceHandlers(server *mcp.Server, resolver ResolverInterface) {
	server.AddResource(
		&mcp.Resource{
			URI:         "docs://readme",
			Name:        "Demo README",
			Description: "Documentation for the demo server",
			MIMEType:    "text/markdown",
		},
		resolver.DemoREADMEResource,
	)
	server.AddResourceTemplate(
		&mcp.ResourceTemplate{
			URITemplate: "task://{id}",
			Name:        "Task Details",
			Description: "Get details for a specific task",
			MIMEType:    "application/json",
		},
		resolver.TaskDetailsResource,
	)
	server.AddResourceTemplate(
		&mcp.ResourceTemplate{
			URITemplate: "result://{operation}",
			Name:        "Last Result",
			Description: "Get the last result for a specific operation",
			MIMEType:    "application/json",
		},
		resolver.LastResultResource,
	)
}

func registerPromptHandlers(server *mcp.Server, resolver ResolverInterface) {
	mcputil.AddPrompt(
		server,
		&mcp.Prompt{
			Name:        "task_help",
			Description: "Get help with task management",
			Arguments: []*mcp.PromptArgument{
				{
					Name:        "topic",
					Description: "The help topic (tasks, priorities, etc)",
					Required:    false,
				},
				{
					Name:        "detailed",
					Description: "Whether to show detailed help",
					Required:    false,
				},
			},
		},
		resolver.TaskHelpPrompt,
	)
	mcputil.AddPrompt(
		server,
		&mcp.Prompt{
			Name:        "math_help",
			Description: "Get help with mathematical operations",
			Arguments: []*mcp.PromptArgument{
				{
					Name:        "operation",
					Description: "The operation to get help with",
					Required:    false,
				},
			},
		},
		resolver.MathHelpPrompt,
	)
}
